<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mia's Sugar - Pedidos</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #FFF5F7; color: #5D4037; margin: 0; padding-bottom: 200px; }
        .header { background-color: #F8BBD0; color: white; text-align: center; padding: 20px; position: sticky; top: 0; z-index: 100; }
        .card { background: white; margin: 15px; padding: 15px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        h3 { color: #AD1457; border-bottom: 2px solid #F8BBD0; margin-top: 0; font-size: 1.2em; }
        .producto { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f9f9f9; }
        .btn-add { background: #AD1457; border: none; border-radius: 12px; padding: 10px 18px; color: white; font-weight: bold; cursor: pointer; }
        
        /* ESTILOS DE LA CESTA */
        .footer-pedido { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); box-sizing: border-box; border-radius: 25px 25px 0 0; }
        .cesta-preview { background: #fdfdfd; border: 1px dashed #AD1457; border-radius: 10px; padding: 10px; margin-bottom: 10px; max-height: 100px; overflow-y: auto; font-size: 0.9em; }
        .item-cesta { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px solid #eee; padding-bottom: 2px; }
        .btn-enviar { background: #AD1457; color: white; border: none; padding: 18px; border-radius: 35px; font-size: 1.2em; font-weight: bold; width: 100%; }
        .btn-limpiar { background: none; border: none; color: #AD1457; text-decoration: underline; font-size: 0.8em; cursor: pointer; margin-bottom: 5px; }
        
        #seccion-menu { display: none; }
        .btn-ubi { width: 100%; padding: 25px; margin: 15px 0; border-radius: 20px; border: none; font-size: 1.3em; font-weight: bold; cursor: pointer; color: white; }
    </style>
</head>
<body>

    <div id="pantalla-inicio" style="padding: 50px 25px; text-align: center;">
        <h1 style="color: #AD1457;">Mia's Sugar</h1>
        <p>¬øD√≥nde te sientas hoy?</p>
        <button class="btn-ubi" style="background: #F8BBD0;" onclick="iniciar('Saloncito')">ü™ë Saloncito</button>
        <button class="btn-ubi" style="background: #0277BD;" onclick="iniciar('Terraza')">‚òÄÔ∏è Terraza</button>
    </div>

    <div id="seccion-menu">
        <div class="header"><h2 id="display-ubi" style="margin:0;">Mia's Sugar</h2></div>

        <div class="card">
            <h3>‚òï Caf√©s Destacados</h3>
            <div class="producto"><span>Mia's Sugar Caf√© (5‚Ç¨)</span> <button class="btn-add" onclick="sumar('Mia Sugar Cafe', 5.00)">A√±adir</button></div>
            <div class="producto"><span>Frapp√© (4.50‚Ç¨)</span> <button class="btn-add" onclick="sumar('Frappe', 4.50)">A√±adir</button></div>
            <div class="producto"><span>Caf√© Nutella (3‚Ç¨)</span> <button class="btn-add" onclick="sumar('Cafe Nutella', 3.00)">A√±adir</button></div>
        </div>

        <div class="card">
            <h3>ü•™ Salados</h3>
            <div class="producto"><span>York + Queso (5‚Ç¨)</span> <button class="btn-add" onclick="sumar('Salado York', 5.00)">A√±adir</button></div>
            <div class="producto"><span>Especial Pistacho (7‚Ç¨)</span> <button class="btn-add" onclick="sumar('Salado Pistacho', 7.00)">A√±adir</button></div>
        </div>

        <div class="card">
            <h3>üìù Notas</h3>
            <textarea id="notas" placeholder="Ej: Sin az√∫car, leche de soja..." style="width:100%; border-radius:10px; border:1px solid #ddd; padding:10px; height:60px; font-family:inherit;"></textarea>
        </div>

        <div class="footer-pedido">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-weight: bold; color: #AD1457;">Tu Cesta:</span>
                <button class="btn-limpiar" onclick="limpiarCesta()">Vaciar cesta</button>
            </div>
            
            <div id="cesta-lista" class="cesta-preview">La cesta est√° vac√≠a</div>
            
            <div id="resumen-total" style="margin-bottom: 10px; font-weight: bold; font-size: 1.1em; text-align: center;">Total: 0.00‚Ç¨</div>
            <button class="btn-enviar" id="btn-enviar-accion" onclick="enviarPedido()">PEDIR AHORA</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://mia-s-sugar-default-rtdb.europe-west1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let pedidoActual = [];
        let total = 0;
        let miUbicacion = "";

        function iniciar(ubi) {
            miUbicacion = ubi;
            document.getElementById('pantalla-inicio').style.display = 'none';
            document.getElementById('seccion-menu').style.display = 'block';
            document.getElementById('display-ubi').innerText = "Mesa: " + ubi;
            window.scrollTo(0,0);
        }

        function sumar(nombre, precio) {
            pedidoActual.push({nombre, precio});
            total += precio;
            actualizarCestaUI();
        }

        function limpiarCesta() {
            pedidoActual = [];
            total = 0;
            actualizarCestaUI();
        }

        function actualizarCestaUI() {
            const listaDiv = document.getElementById('cesta-lista');
            if (pedidoActual.length === 0) {
                listaDiv.innerHTML = "La cesta est√° vac√≠a";
                document.getElementById('resumen-total').innerText = "Total: 0.00‚Ç¨";
                return;
            }

            let html = "";
            pedidoActual.forEach((item) => {
                html += `<div class="item-cesta"><span>${item.nombre}</span><span>${item.precio.toFixed(2)}‚Ç¨</span></div>`;
            });
            listaDiv.innerHTML = html;
            document.getElementById('resumen-total').innerText = "Total: " + total.toFixed(2) + "‚Ç¨";
            
            // Auto-scroll al √∫ltimo item a√±adido
            listaDiv.scrollTop = listaDiv.scrollHeight;
        }

        function enviarPedido() {
            if (pedidoActual.length === 0) return alert("A√±ade algo a la cesta primero");
            
            const notasVal = document.getElementById('notas').value;
            const productosNombres = pedidoActual.map(p => p.nombre);

            db.ref('pedidos/').push({
                ubicacion: miUbicacion,
                productos: productosNombres,
                total: total.toFixed(2) + "‚Ç¨",
                notas: notasVal,
                estado: "Nuevo",
                hora: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            }).then(() => {
                alert("¬°Pedido enviado! Enseguida te lo servimos.");
                location.reload();
            });
        }
    </script>
</body>
</html>
